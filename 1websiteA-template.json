{
    "parameters": {
        "deployment.id": {
            "type": "string"
        },
        "deployment.location": {
            "type": "string",
            "defaultValue": "[resourceGroup().location]"
        },
        "site.name": {
            "type": "string",
            "defaultValue": "[concat(parameters('deployment.id'), '-apps-a')]"
        },
        "site.location": {
            "type": "string",
            "defaultValue": "[parameters('deployment.location')]"
        },
        "sql.name": {
            "type": "string",
            "defaultValue": "[concat(parameters('deployment.id'), '-sql')]"
        },
        "sql.login": {
            "type": "string"
        },
        "sql.password": {
            "type": "securestring"
        },
        "sql.location" : {
            "type" : "string",
            "defaultValue": "[resourceGroup().location]"
        },
        "db.name": {
            "type": "string",
            "defaultValue": "[concat(parameters('deployment.id'), '-db-a')]"
        },
        "db.edition": {
            "type": "string",
            "defaultValue": "Standard"
        },
        "db.collation": {
            "type": "string",
            "defaultValue": "SQL_Latin1_General_CP1_CI_AS"
        },
        "db.maxSizeBytes": {
            "type": "string",
            "defaultValue": "268435456000"
        },
        "db.tierId": {
            "type": "string",
            "defaultValue": "f1173c43-91bd-4aaa-973c-54e79e15235b"
        },
        "hplan.name": {
            "type": "string",
            "defaultValue": "[concat(parameters('deployment.id'), '-hp')]"
        }
    },
    "variables" : {
        "hplan.reference": {
            "value": "[concat(resourceGroup().id, '/providers/Microsoft.Web/serverfarms/', parameters('hplan.name'))]"
        }
    },
    "resources": [
        {
            "name": "[parameters('site.name')]",
            "type": "Microsoft.Web/sites",
            "properties": {
                "siteConfig": {
                    "connectionStrings": [
                        {
                            "name": "defaultConnection",
                            "ConnectionString": "[concat('Data Source=tcp:', reference(resourceId('Microsoft.SQL/servers', parameters('sql.name'))).fullyQualifiedDomainName, ',1433;Initial Catalog=', parameters('db.name'), ';User Id=', parameters('sql.login'), '@', reference(resourceId('Microsoft.SQL/servers', parameters('sql.name'))).fullyQualifiedDomainName, ';Password=', parameters('sql.password'),';')]",
                            "type": "SQLAzure"
                        }
                    ]
                },
                "name": "[parameters('site.name')]",
                "serverFarmId": "[resourceId('Microsoft.Web/serverfarms', parameters('hplan.name'))]"
            },
            "apiVersion": "2016-03-01",
            "location": "[parameters('site.location')]",
            "tags": {
                "[concat('hidden-related:', resourceId('Microsoft.Web/serverfarms', parameters('hplan.name')))]": "empty"
            }
        },
        {
            "name": "[parameters('sql.name')]",
            "type": "Microsoft.Sql/servers",
            "apiVersion": "2014-04-01-preview",
            "location": "[resourceGroup().location]",
            "resources": [
                {
                    "name": "[parameters('db.name')]",
                    "type": "databases",
                    "apiVersion": "2014-04-01-preview",
                    "location" : "[parameters('sql.location')]",
                    "properties": {
                        "edition": "[parameters('db.edition')]",
                        "collation": "[parameters('db.collation')]",
                        "maxSizeBytes": "[parameters('db.maxSizeBytes')]",
                        "requestedServiceObjectiveId": "[parameters('db.tierId')]"
                    },
                    "dependsOn": [
                        "[concat('Microsoft.Sql/servers/', parameters('sql.name'))]"
                    ]
                }
            ]
        }
    ],
    "$schema": "http://schema.management.azure.com/schemas/2014-04-01-preview/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0"
}